apiVersion: v1
kind: Service
metadata:
  name: energy-router-service
  namespace: microgrid-control
  labels:
    app: energy-router
    tier: networking
    # Tag for Prometheus to automatically scrape physics metrics
    monitor: prometheus-scrape 
spec:
  # type: NodePort
  # Chosen for Edge Compatibility: Allows external SCADA/HMI to access 
  # the API via the Device's LAN IP (e.g., http://192.168.1.50:30080)
  type: NodePort
  
  selector:
    # Traffic is routed to pods with this label (The Backend)
    app: energy-router
    
  ports:
    - name: http-api
      protocol: TCP
      
      # The port inside the K3s cluster (Service IP)
      port: 8000
      
      # The port the Container is actually listening on (FastAPI)
      targetPort: 8000
      
      # The fixed port exposed on the physical Edge Device
      # Standardized to 30080 for Firewall/IT compliance
      nodePort: 30080
      
